<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã GeekVanlife To Do Lists</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìã</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <link rel="stylesheet" href="css/todos.css">
</head>
<body>
    <a href="./index.html" class="back-button" title="Accueil">
        <i class="fas fa-home"></i>
        <span class="back-button-text">Accueil</span>
    </a>

    <div class="container">
        <div class="header">
            <h1>üìã To Do Lists</h1>
            <p class="subtitle">Centre de gestion des t√¢ches pour tous les projets GeekVanlife</p>
        </div>

        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-button forkx active" onclick="switchTab('forkx')">üöóüåµ ForkX</button>
                <button class="tab-button geekomobile" onclick="switchTab('geekomobile')">üöêüöÄ Geekomobile</button>
                <button class="tab-button geekagne" onclick="switchTab('geekagne')">üè°üå≤ Geekagne</button>
            </div>

            <div id="forkx-tab" class="tab-content active">
                <div class="todo-form-section">
                    <div class="form-title">
                        <span>Ajouter une nouvelle t√¢che</span>
                        <div class="form-title-actions">
                            <button class="btn-action-icon" onclick="exportTodos('forkx')" title="Exporter les t√¢ches"><i class="fas fa-upload"></i></button>
                            <button class="btn-action-icon" onclick="openJsonImportModal('forkx')" title="Importer les t√¢ches"><i class="fas fa-download"></i></button>
                            <button class="btn-action-icon" onclick="openImageImportModal('forkx')" title="Importer depuis une image"><i class="fas fa-image"></i></button>
                        </div>
                    </div>
                    <div class="form-content">
                        <div class="task-list-row">
                            <div class="task-input-wrapper">
                                <button class="task-input-icon" onclick="addTodo('forkx')" title="Ajouter la t√¢che"><i class="fas fa-clipboard-check"></i></button>
                                <input type="text" id="forkx-task-name" placeholder="Nom de la t√¢che..." onkeypress="if(event.key==='Enter') addTodo('forkx')" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                            </div>
                            <div class="list-input-group">
                                <select id="forkx-list-select" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                                    <option value="">-- S√©lectionner --</option>
                                </select>
                                <button class="list-add-icon" onclick="openListModal('forkx')" title="Ajouter une liste"><i class="fas fa-tasks"></i></button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" id="forkx-amount" placeholder="Montant (‚Ç¨)" step="0.01">
                            </div>
                            <div class="form-group" style="display: flex; justify-content: center; align-items: center;">
                                <div class="priority-selector">
                                    <button class="priority-btn" data-priority="low" onclick="selectPriority(this, 'forkx')">üü¢</button>
                                    <button class="priority-btn" data-priority="medium" onclick="selectPriority(this, 'forkx')">üü°</button>
                                    <button class="priority-btn" data-priority="high" onclick="selectPriority(this, 'forkx')">üî¥</button>
                                    <input type="hidden" id="forkx-priority" value="medium">
                                </div>
                            </div>
                        </div>

                        <div class="accordion-section">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span class="accordion-toggle">+</span>
                                <span>Options suppl√©mentaires</span>
                            </div>
                            <div class="accordion-content">
                                <div class="accordion-body">
                                    <div class="form-group">
                                        <label><i class="fas fa-link"></i> Lien (optionnel)</label>
                                        <input type="url" id="forkx-link" placeholder="https://...">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-sticky-note"></i> Note (optionnel)</label>
                                        <textarea id="forkx-note" placeholder="D√©tails suppl√©mentaires..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-divider"></div>
                <div class="lists-container" id="forkx-lists"></div>
                <div id="forkx-empty" class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <p>Aucune t√¢che pour le moment !</p>
                </div>
            </div>

            <div id="geekomobile-tab" class="tab-content">
                <div class="todo-form-section">
                    <div class="form-title">
                        <span>Ajouter une nouvelle t√¢che</span>
                        <div class="form-title-actions">
                            <button class="btn-action-icon" onclick="exportTodos('geekomobile')" title="Exporter les t√¢ches"><i class="fas fa-upload"></i></button>
                            <button class="btn-action-icon" onclick="openJsonImportModal('geekomobile')" title="Importer les t√¢ches"><i class="fas fa-download"></i></button>
                            <button class="btn-action-icon" onclick="openImageImportModal('geekomobile')" title="Importer depuis une image"><i class="fas fa-image"></i></button>
                        </div>
                    </div>
                    <div class="form-content">
                        <div class="task-list-row">
                            <div class="task-input-wrapper">
                                <button class="task-input-icon" onclick="addTodo('geekomobile')" title="Ajouter la t√¢che"><i class="fas fa-clipboard-check"></i></button>
                                <input type="text" id="geekomobile-task-name" placeholder="Nom de la t√¢che..." onkeypress="if(event.key==='Enter') addTodo('geekomobile')" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                            </div>
                            <div class="list-input-group">
                                <select id="geekomobile-list-select" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                                    <option value="">-- S√©lectionner --</option>
                                </select>
                                <button class="list-add-icon" onclick="openListModal('geekomobile')" title="Ajouter une liste"><i class="fas fa-tasks"></i></button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" id="geekomobile-amount" placeholder="Montant (‚Ç¨)" step="0.01">
                            </div>
                            <div class="form-group" style="display: flex; justify-content: center; align-items: center;">
                                <div class="priority-selector">
                                    <button class="priority-btn" data-priority="low" onclick="selectPriority(this, 'geekomobile')">üü¢</button>
                                    <button class="priority-btn" data-priority="medium" onclick="selectPriority(this, 'geekomobile')">üü°</button>
                                    <button class="priority-btn" data-priority="high" onclick="selectPriority(this, 'geekomobile')">üî¥</button>
                                    <input type="hidden" id="geekomobile-priority" value="medium">
                                </div>
                            </div>
                        </div>

                        <div class="accordion-section">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span class="accordion-toggle">+</span>
                                <span>Options suppl√©mentaires</span>
                            </div>
                            <div class="accordion-content">
                                <div class="accordion-body">
                                    <div class="form-group">
                                        <label><i class="fas fa-link"></i> Lien (optionnel)</label>
                                        <input type="url" id="geekomobile-link" placeholder="https://...">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-sticky-note"></i> Note (optionnel)</label>
                                        <textarea id="geekomobile-note" placeholder="D√©tails suppl√©mentaires..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-divider"></div>
                <div class="lists-container" id="geekomobile-lists"></div>
                <div id="geekomobile-empty" class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <p>Aucune t√¢che pour le moment !</p>
                </div>
            </div>

            <div id="geekagne-tab" class="tab-content">
                <div class="todo-form-section">
                    <div class="form-title">
                        <span>Ajouter une nouvelle t√¢che</span>
                        <div class="form-title-actions">
                            <button class="btn-action-icon" onclick="exportTodos('geekagne')" title="Exporter les t√¢ches"><i class="fas fa-upload"></i></button>
                            <button class="btn-action-icon" onclick="openJsonImportModal('geekagne')" title="Importer les t√¢ches"><i class="fas fa-download"></i></button>
                            <button class="btn-action-icon" onclick="openImageImportModal('geekagne')" title="Importer depuis une image"><i class="fas fa-image"></i></button>
                        </div>
                    </div>
                    <div class="form-content">
                        <div class="task-list-row">
                            <div class="task-input-wrapper">
                                <button class="task-input-icon" onclick="addTodo('geekagne')" title="Ajouter la t√¢che"><i class="fas fa-clipboard-check"></i></button>
                                <input type="text" id="geekagne-task-name" placeholder="Nom de la t√¢che..." onkeypress="if(event.key==='Enter') addTodo('geekagne')" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                            </div>
                            <div class="list-input-group">
                                <select id="geekagne-list-select" style="flex: 1; padding: 10px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem;">
                                    <option value="">-- S√©lectionner --</option>
                                </select>
                                <button class="list-add-icon" onclick="openListModal('geekagne')" title="Ajouter une liste"><i class="fas fa-tasks"></i></button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <input type="number" id="geekagne-amount" placeholder="Montant (‚Ç¨)" step="0.01">
                            </div>
                            <div class="form-group" style="display: flex; justify-content: center; align-items: center;">
                                <div class="priority-selector">
                                    <button class="priority-btn" data-priority="low" onclick="selectPriority(this, 'geekagne')">üü¢</button>
                                    <button class="priority-btn" data-priority="medium" onclick="selectPriority(this, 'geekagne')">üü°</button>
                                    <button class="priority-btn" data-priority="high" onclick="selectPriority(this, 'geekagne')">üî¥</button>
                                    <input type="hidden" id="geekagne-priority" value="medium">
                                </div>
                            </div>
                        </div>

                        <div class="accordion-section">
                            <div class="accordion-header" onclick="toggleAccordion(this)">
                                <span class="accordion-toggle">+</span>
                                <span>Options suppl√©mentaires</span>
                            </div>
                            <div class="accordion-content">
                                <div class="accordion-body">
                                    <div class="form-group">
                                        <label><i class="fas fa-link"></i> Lien (optionnel)</label>
                                        <input type="url" id="geekagne-link" placeholder="https://...">
                                    </div>
                                    <div class="form-group">
                                        <label><i class="fas fa-sticky-note"></i> Note (optionnel)</label>
                                        <textarea id="geekagne-note" placeholder="D√©tails suppl√©mentaires..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-divider"></div>
                <div class="lists-container" id="geekagne-lists"></div>
                <div id="geekagne-empty" class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <p>Aucune t√¢che pour le moment !</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal d'import d'image -->
    <div id="image-import-modal" class="image-import-modal">
        <div class="image-import-content">
            <div class="image-import-header">üì∏ Importer une liste depuis une image</div>
            
            <!-- Label wrapper pour meilleure accessibilit√© mobile -->
            <label for="image-input" class="image-upload-zone" id="upload-zone" style="cursor: pointer; display: block;">
                <div class="upload-icon"><i class="fas fa-image"></i></div>
                <div class="upload-text">Glissez-d√©posez une image ici</div>
                <div class="upload-subtext">ou cliquez pour s√©lectionner une image</div>
                <!-- Input file cach√© mais dans le label pour meilleure accessibilit√© -->
                <input type="file" id="image-input" accept="image/*" onchange="handleImageSelect(event)" style="display:none;">
            </label>
            
            <div id="processing-container" style="display:none;">
                <div class="processing-indicator">
                    <div class="spinner"></div>
                    <p>Analyse de l'image en cours...</p>
                </div>
            </div>

            <div id="image-preview" class="image-preview" style="display:none;">
                <img id="preview-img" src="" alt="Aper√ßu">
            </div>

            <div id="ocr-container" style="display:none;">
                <label>Texte d√©tect√© :</label>
                <div class="ocr-result" id="ocr-result"></div>
            </div>

            <div id="todo-preview-container" style="display:none;">
                <label>T√¢ches extraites :</label>
                <div class="todo-preview-list" id="todo-preview-list"></div>
            </div>

            <div id="import-actions-container" style="display:none;" class="import-actions">
                <button id="btn-import-image" class="btn-import" onclick="importFromImage()">Importer ces t√¢ches</button>
                <button class="btn-close-import" onclick="closeImageImportModal()">Annuler</button>
            </div>

            <div id="no-import-actions" class="import-actions">
                <button class="btn-close-import" onclick="closeImageImportModal()" style="flex:1;">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modal d'import JSON -->
    <div id="json-import-modal" class="image-import-modal">
        <div class="image-import-content">
            <div class="image-import-header">üì• Importer un fichier JSON</div>
            
            <div class="image-upload-zone" id="json-upload-zone" onclick="document.getElementById('json-import-input').click()">
                <div class="upload-icon"><i class="fas fa-file-import"></i></div>
                <div class="upload-text">Cliquez pour s√©lectionner un fichier</div>
                <div class="upload-subtext">ou glissez-d√©posez un fichier JSON ici</div>
            </div>
            
            <input type="file" id="json-import-input" accept=".json" onchange="handleJsonImportSelect(event)">
            
            <div id="json-import-actions" class="import-actions">
                <button class="btn-close-import" onclick="closeJsonImportModal()" style="flex:1;">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Modal de synchronisation universelle -->
    <div id="sync-modal" class="image-import-modal">
        <div class="image-import-content">
            <div class="image-import-header">üîÑ Code de Partage Universel</div>
            
            <div style="padding: 20px;">
                <div style="margin-bottom: 20px; padding: 10px; background: #f0f4ff; border-radius: 8px;">
                    <p style="margin: 0; color: #333; font-size: 0.95rem;">
                        <strong>‚ú® Partagez toutes vos donn√©es</strong> (todos, param√®tres, et tout le contenu de votre application) entre vos appareils sans importer/exporter !
                    </p>
                </div>
                
                <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <label style="display: block; text-align: left; margin-bottom: 8px; font-weight: 600;">üîê Votre code de partage :</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="sync-code" readonly style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; background: white;" placeholder="SHARE-00000-00000">
                        <button onclick="copySyncCode()" style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">üìã Copier</button>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #999;">Valide 7 jours - Partagez ce code avec vos autres appareils</p>
                </div>
                
                <div style="background: #f0f4ff; padding: 15px; border-radius: 8px;">
                    <label style="display: block; text-align: left; margin-bottom: 8px; font-weight: 600;">üîó Restaurer √† partir d'un code :</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="sync-code-input" placeholder="0001XXXXX" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace;">
                        <button onclick="syncWithCode()" style="padding: 10px 15px; background: #11998e; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">‚úì Restaurer</button>
                    </div>
                    <p style="margin: 8px 0 0 0; font-size: 0.8rem; color: #999;">Entrez le code re√ßu d'un autre appareil</p>
                </div>
            </div>
            
            <div class="import-actions">
                <button class="btn-close-import" onclick="closeSyncModal()" style="flex:1;">Fermer</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (global) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <!-- Application Scripts -->
    <script src="js/todos.js"></script>
    <script src="js/firebase-sync.js"></script>
</body>
</html>
